pipeline {
    agent any
    environment {
        DOCKERHUB = credentials('dockerhub')
        DOCKERURL = "docker.io"
        DOCKERUSR = "jithendar"
        COMPONENT = "frontend"
    }

    // parameters {
    // choice(name: 'DKIM_Option', choices: ['Build DKIM', 'Push DKIM',], description: 'Pick Docker Option')
    // text(name: 'tag', defaultValue: '', description: 'Enter the DKIM tag number/name')
    // }

    stages {
        
        stage ('Build DKIM ${env.COMPONENT}') {
            steps {
                sh '''
                tag=$(git tag -l | tail -n 1)
                echo $tag
                docker build -t ${DOCKERURL}/${DOCKERUSR}/${COMPONENT}:$tag .
                '''
            }
            }
        stage ('Push DKIM ${env.COMPONENT}') {
            steps {
                sh '''
                tag=$(git tag -l | tail -n 1)
                docker login -u $DOCKERHUB_USR -p $DOCKERHUB_PSW"
                docker push ${DOCKERURL}/${DOCKERUSR}/${COMPONENT}:$tag"
                '''
                }
              }
            }
    post {
        success {
            sh 'docker logout'
            }
        always { 
            cleanWs()
        }
     }
}
